<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard OS Pro</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>♠️</text></svg>">

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-color: #000;
            --glass-opacity: 0.75;
            --glass-blur: 20px; /* Dynamic Variable */

            --glass: rgba(20, 20, 20, var(--glass-opacity));
            --glass-hover: rgba(40, 40, 40, 0.85);
            --glass-border: rgba(255, 255, 255, 0.12);
            --border-width: 1px;
            --accent: #3b82f6;
            --btn-text: #ffffff;
            --text: #ffffff;
            --danger: #ef4444;
            --success: #10b981;
            --warning: #f59e0b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }

        body {
            height: 100vh; width: 100vw; overflow: hidden;
            background-color: var(--bg-color);
            background-size: cover; background-position: center;
            display: flex; align-items: center; justify-content: center;
            transition: background-image 0.6s ease-in-out;
        }

        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 20%, rgba(0,0,0,0.8) 100%);
            z-index: 1; pointer-events: none;
        }

        .main-container {
            position: relative; z-index: 2;
            width: 100%; height: 100vh;
            overflow-y: auto; overflow-x: hidden;
            padding: 80px 20px 50px 20px;
            display: flex; flex-direction: column; align-items: center;
            transition: opacity 0.5s ease;
        }
        .main-container.zen-mode { opacity: 0; pointer-events: none; }

        .main-container::-webkit-scrollbar { width: 8px; }
        .main-container::-webkit-scrollbar-track { background: transparent; }
        .main-container::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 4px; }
        .main-container::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.4); }

        /* --- HEADER SECTION --- */
        .header-section {
            width: 100%; max-width: 800px;
            display: flex; flex-direction: column; align-items: center;
            margin-bottom: 40px;
        }

        .widget-clock { margin-bottom: 2rem; user-select: none; text-align: center; }
        .time {
            font-size: 7rem; font-weight: 800; line-height: 0.9; color: white;
            text-shadow: 0 10px 30px rgba(0,0,0,0.5); letter-spacing: -3px;
            background: linear-gradient(to bottom, #fff, #aaa);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .date-row { font-size: 1.1rem; color: rgba(255,255,255,0.8); font-weight: 500; margin-top: 10px; }
        .greeting { color: var(--accent); font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }

        .search-container { width: 100%; position: relative; }
        .search-engines { display: flex; justify-content: center; gap: 15px; margin-bottom: 15px; }
        .engine-btn {
            background: var(--glass); border: var(--border-width) solid var(--glass-border); color: #ddd;
            width: 45px; height: 45px; border-radius: 12px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
            font-size: 1.2rem; box-shadow: 0 4px 15px rgba(0,0,0,0.3); backdrop-filter: blur(var(--glass-blur));
        }
        .engine-btn:hover { background: rgba(255,255,255,0.2); color: white; transform: translateY(-3px); }
        .engine-btn.active {
            background: var(--accent); color: var(--btn-text); box-shadow: 0 0 20px rgba(0,0,0,0.4); border-color: var(--accent);
        }

        .search-input {
            width: 100%; padding: 18px 50px 18px 30px;
            border-radius: 20px; border: var(--border-width) solid var(--glass-border);
            background: var(--glass); backdrop-filter: blur(var(--glass-blur));
            color: white; font-size: 1.1rem; outline: none;
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
            transition: 0.3s;
        }
        .search-input:focus {
            background: rgba(40, 40, 40, 0.95); border-color: var(--accent);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3); transform: scale(1.01);
        }
        .search-icon {
            position: absolute; right: 25px; bottom: 20px;
            color: rgba(255,255,255,0.4); pointer-events: none; font-size: 1.2rem;
        }

        /* --- CONTENT GRID --- */
        .dashboard-grid {
            display: flex; flex-wrap: wrap; justify-content: center; align-items: flex-start;
            gap: 30px; width: 100%; max-width: 1200px;
        }

        .links-area { flex: 1; min-width: 300px; width: 100%; }
        .links-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 15px; }
        .shortcut {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100px; background: var(--glass); backdrop-filter: blur(var(--glass-blur));
            border: var(--border-width) solid var(--glass-border); border-radius: 18px;
            text-decoration: none; color: white; transition: 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .shortcut:hover {
            transform: translateY(-5px); background: var(--glass-hover);
            border-color: var(--accent); box-shadow: 0 10px 25px rgba(0,0,0,0.4);
        }
        .shortcut i { font-size: 2rem; margin-bottom: 8px; color: #ddd; }
        .shortcut span { font-size: 0.8rem; font-weight: 500; opacity: 0.8; text-align: center; }

        .widgets-column { width: 350px; flex-shrink: 0; display: flex; flex-direction: column; gap: 20px; }
        @media (min-width: 900px) { .widgets-column { position: sticky; top: 20px; } }
        @media (max-width: 899px) { .widgets-column { width: 100%; } }

        .glass-card {
            background: var(--glass); border: var(--border-width) solid var(--glass-border);
            border-radius: 18px; padding: 20px; backdrop-filter: blur(var(--glass-blur));
            display: flex; flex-direction: column; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .glass-card.hidden { display: none; }

        /* Weather */
        .weather-widget { align-items: center; text-align: center; cursor: pointer; transition: 0.2s; }
        .weather-widget:hover { background: var(--glass-hover); border-color: var(--accent); }
        .weather-top { display: flex; align-items: center; gap: 15px; }
        .weather-icon { font-size: 2.5rem; color: var(--accent); }
        .weather-temp { font-size: 2.2rem; font-weight: 700; }
        .weather-details { text-align: left; }
        .weather-desc { font-size: 0.9rem; color: #bbb; text-transform: capitalize; }
        .weather-loc { font-size: 0.8rem; color: #777; }

        /* Crypto Ticker */
        .crypto-widget { padding: 15px 20px; }
        .crypto-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 8px; }
        .crypto-row:last-child { margin-bottom: 0; border-bottom: none; padding-bottom: 0; }
        .crypto-name { font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .crypto-price { font-family: monospace; color: var(--success); }

        /* Timer */
        .timer-widget { text-align: center; }
        .timer-display { font-size: 3rem; font-weight: 800; line-height: 1; margin: 10px 0; font-variant-numeric: tabular-nums; }
        .timer-controls { display: flex; gap: 10px; justify-content: center; }
        .timer-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 5px 15px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .timer-btn:hover { background: var(--accent); border-color: var(--accent); }

        /* Todo */
        .widget-header { font-size: 1rem; font-weight: 700; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; color: #eee; }
        .todo-input-row { display: flex; gap: 8px; margin-bottom: 10px; }
        .todo-input {
            flex: 1; background: rgba(255,255,255,0.05); border: 1px solid #333;
            color: white; padding: 10px; border-radius: 8px; outline: none; font-size: 0.9rem;
        }
        .todo-btn {
            background: var(--accent); border: none; color: var(--btn-text); width: 38px;
            border-radius: 8px; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .todo-list { list-style: none; max-height: 200px; overflow-y: auto; padding-right: 5px; }
        .todo-list::-webkit-scrollbar { width: 4px; }
        .todo-list::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }

        .todo-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.9rem;
        }
        .todo-item span { cursor: pointer; transition: 0.2s; }
        .todo-item.done span { text-decoration: line-through; color: #555; }
        .del-task { color: #555; cursor: pointer; font-size: 0.8rem; padding: 5px; }
        .del-task:hover { color: var(--danger); }

        /* Notepad */
        #notepad {
            width: 100%; height: 150px; background: transparent; border: none;
            color: #ddd; resize: none; outline: none; font-family: inherit; font-size: 0.9rem; line-height: 1.5;
        }
        #notepad::placeholder { color: #555; }

        /* --- CONTROLS --- */
        .top-controls { position: fixed; top: 20px; right: 20px; z-index: 100; display: flex; gap: 15px; }
        .control-btn {
            width: 45px; height: 45px; border-radius: 50%;
            background: var(--glass); border: var(--border-width) solid var(--glass-border);
            color: white; cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: 0.3s; backdrop-filter: blur(5px); font-size: 1.1rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }
        .control-btn:hover { background: var(--accent); color: var(--btn-text); transform: rotate(15deg); border-color: var(--accent); }

        /* --- MODAL --- */
        .modal-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); backdrop-filter: blur(15px);
            z-index: 200; display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: 0.3s;
        }
        .modal-bg.open { opacity: 1; pointer-events: all; }
        .modal {
            width: 90%; max-width: 900px; height: 85vh;
            background: #121212; border: 1px solid #333; border-radius: 24px;
            display: flex; overflow: hidden; box-shadow: 0 50px 100px rgba(0,0,0,0.9);
            transform: scale(0.95); transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .modal-bg.open .modal { transform: scale(1); }
        .sidebar { width: 220px; background: #181818; border-right: 1px solid #222; padding: 25px; display: flex; flex-direction: column; gap: 8px; flex-shrink: 0; }
        .nav-btn { background: transparent; border: none; color: #888; padding: 14px; text-align: left; border-radius: 12px; cursor: pointer; font-weight: 600; display: flex; gap: 10px; align-items: center; transition: 0.2s; }
        .nav-btn:hover { background: #222; color: white; }
        .nav-btn.active { background: var(--accent); color: var(--btn-text); }
        .content { flex: 1; padding: 30px; overflow-y: auto; }
        .view { display: none; }
        .view.active { display: block; }

        /* Modal Grid/Inputs */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .grid-item { aspect-ratio: 16/9; background: #222; border-radius: 12px; overflow: hidden; cursor: pointer; transition: 0.2s; }
        .grid-item:hover { transform: scale(1.02); border: 2px solid var(--accent); }
        .grid-item img { width: 100%; height: 100%; object-fit: cover; }
        .modal-input { width: 100%; padding: 12px; background: #0a0a0a; border: 1px solid #333; color: white; border-radius: 10px; margin-bottom: 10px; outline: none; }
        .modal-input:focus { border-color: var(--accent); }

        .btn {
            padding: 10px 20px; background: var(--accent); color: var(--btn-text); border: none;
            border-radius: 8px; cursor: pointer; font-weight: 700;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: 0.2s;
        }
        .btn:hover { filter: brightness(1.1); transform: translateY(-1px); }

        .load-more-btn {
            width: 100%; padding: 15px; margin-top: 20px; background: #222; color: #aaa;
            border: none; border-radius: 12px; cursor: pointer; font-weight: 600;
            display: none; transition: 0.2s; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .load-more-btn:hover { background: #333; color: white; }

        /* Toggle */
        .switch { width: 44px; height: 24px; background: #333; border-radius: 20px; position: relative; cursor: pointer; transition: 0.3s; }
        .switch::after { content:''; position: absolute; top: 3px; left: 3px; width: 18px; height: 18px; background: white; border-radius: 50%; transition: 0.3s; }
        .switch.on { background: var(--accent); }
        .switch.on::after { transform: translateX(20px); }
        .setting-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #222; color: white; }

        /* Slider */
        .slider { -webkit-appearance: none; width: 100px; height: 6px; border-radius: 3px; background: #333; outline: none; }
        .slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 18px; height: 18px; border-radius: 50%; background: var(--accent); cursor: pointer; }

        /* Responsive Modal */
        @media (max-width: 700px) {
            .modal { flex-direction: column; }
            .sidebar { width: 100%; height: auto; padding: 15px; flex-direction: row; overflow-x: auto; border-right: none; border-bottom: 1px solid #222; }
            .nav-btn { flex: 0 0 auto; }
        }
    </style>
</head>
<body>

    <div class="overlay"></div>

    <!-- Top Controls -->
    <div class="top-controls">
        <button class="control-btn" onclick="toggleZenMode()" title="Zen Mode">
            <i class="fa-regular fa-eye"></i>
        </button>
        <button class="control-btn" onclick="toggleSettings(true)" title="Settings">
            <i class="fa-solid fa-sliders"></i>
        </button>
    </div>

    <!-- MAIN SCROLLABLE CONTAINER -->
    <div class="main-container" id="mainContainer">

        <!-- Header: Clock & Search -->
        <div class="header-section">
            <div class="widget-clock" id="clockWidget">
                <div class="time" id="time">00:00</div>
                <div class="date-row">
                    <span class="greeting" id="greeting">HELLO</span> • <span id="date">Jan 01</span>
                </div>
            </div>

            <div class="search-container">
                <div class="search-engines">
                    <button class="engine-btn active" onclick="setEngine('google', this)" title="Google"><i class="fa-brands fa-google"></i></button>
                    <button class="engine-btn" onclick="setEngine('bing', this)" title="Bing"><i class="fa-brands fa-microsoft"></i></button>
                    <button class="engine-btn" onclick="setEngine('youtube', this)" title="YouTube"><i class="fa-brands fa-youtube"></i></button>
                </div>
                <form id="searchForm" action="https://www.google.com/search" method="GET" target="_blank">
                    <input type="text" id="searchInput" name="q" class="search-input" placeholder="Search Google..." autocomplete="off">
                    <i class="fa-solid fa-search search-icon"></i>
                </form>
            </div>
        </div>

        <!-- Content Grid: Links & Widgets -->
        <div class="dashboard-grid">

            <!-- Left: Links Grid (Grows) -->
            <div class="links-area">
                <div class="links-grid" id="linksContainer"></div>
            </div>

            <!-- Right: Widgets Column (Fixed width on desktop) -->
            <div class="widgets-column">

                <!-- Weather -->
                <div class="glass-card weather-widget" id="weatherWidget" onclick="fetchWeather()">
                    <div class="weather-top">
                        <div id="weatherIcon" class="weather-icon"><i class="fa-solid fa-cloud"></i></div>
                        <div id="weatherTemp" class="weather-temp">--°</div>
                    </div>
                    <div class="weather-details">
                        <div id="weatherDesc" class="weather-desc">Click to update</div>
                        <div id="weatherLoc" class="weather-loc">Weather</div>
                    </div>
                </div>

                <!-- Crypto Ticker -->
                <div class="glass-card crypto-widget" id="cryptoWidget">
                    <div class="widget-header"><span>Market</span> <span style="font-size:0.7rem; color:#666;">Live</span></div>
                    <div id="cryptoList">
                        <div class="crypto-row"><span class="crypto-name"><i class="fa-brands fa-bitcoin" style="color:#f7931a"></i> BTC</span> <span class="crypto-price" id="price-btc">...</span></div>
                        <div class="crypto-row"><span class="crypto-name"><i class="fa-brands fa-ethereum" style="color:#627eea"></i> ETH</span> <span class="crypto-price" id="price-eth">...</span></div>
                        <div class="crypto-row"><span class="crypto-name"><i class="fa-solid fa-layer-group" style="color:#14f195"></i> SOL</span> <span class="crypto-price" id="price-sol">...</span></div>
                    </div>
                </div>

                <!-- Focus Timer -->
                <div class="glass-card timer-widget" id="timerWidget">
                    <div class="widget-header"><span>Focus Timer</span> <i class="fa-solid fa-stopwatch" style="color:#666;"></i></div>
                    <div class="timer-display" id="timerDisplay">25:00</div>
                    <div class="timer-controls">
                        <button class="timer-btn" onclick="startTimer()"><i class="fa-solid fa-play"></i></button>
                        <button class="timer-btn" onclick="pauseTimer()"><i class="fa-solid fa-pause"></i></button>
                        <button class="timer-btn" onclick="resetTimer()"><i class="fa-solid fa-rotate-right"></i></button>
                    </div>
                </div>

                <!-- Todo List -->
                <div class="glass-card todo-widget" id="todoWidget">
                    <div class="widget-header">
                        <span>Tasks</span>
                    </div>
                    <div class="todo-input-row">
                        <input type="text" id="todoInput" class="todo-input" placeholder="New task..." onkeypress="if(event.key==='Enter') addTask()">
                        <button class="todo-btn" onclick="addTask()"><i class="fa-solid fa-plus"></i></button>
                    </div>
                    <ul class="todo-list" id="todoList"></ul>
                </div>

                <!-- Notepad -->
                <div class="glass-card notepad-widget" id="noteWidget">
                    <div class="widget-header">
                        <span>Scratchpad</span>
                        <i class="fa-solid fa-floppy-disk" style="font-size:0.8rem; color:#666;" title="Auto-saved"></i>
                    </div>
                    <textarea id="notepad" placeholder="Type notes here..."></textarea>
                </div>

            </div>
        </div>
    </div>

    <!-- SETTINGS MODAL -->
    <div class="modal-bg" id="settingsModal">
        <div class="modal">
            <div class="sidebar">
                <h2 style="color:white; margin-bottom:20px;">Settings</h2>
                <button class="nav-btn active" onclick="switchTab('tab-wall')"><i class="fa-regular fa-image"></i> Wallpapers</button>
                <button class="nav-btn" onclick="switchTab('tab-layout')"><i class="fa-solid fa-layer-group"></i> Layout</button>
                <button class="nav-btn" onclick="switchTab('tab-conf')"><i class="fa-solid fa-gear"></i> Config</button>
                <button class="nav-btn" onclick="switchTab('tab-link')"><i class="fa-solid fa-link"></i> Links</button>
            </div>
            <div class="content">

                <!-- Wallpaper -->
                <div id="tab-wall" class="view active">
                    <h3 style="color:white; margin-bottom:15px;">Wallhaven Search</h3>
                    <div style="display:flex; gap:10px; margin-bottom:15px;">
                        <input type="text" id="wallInput" class="modal-input" placeholder="e.g. Cyberpunk, Nature..." style="margin:0;" onkeypress="if(event.key==='Enter') searchWallhaven(true)">
                        <button class="btn" style="width:auto;" onclick="searchWallhaven(true)">Search</button>
                    </div>
                    <div style="background:#1a1a1a; padding:15px; border-radius:12px; margin-bottom:20px; border:1px solid #333;">
                        <div class="setting-item" style="padding-top:0;"><span><i class="fa-solid fa-check-circle" style="color:var(--success)"></i> SFW</span><div class="switch" id="toggleSFW" onclick="togglePurity('sfw')"></div></div>
                        <div class="setting-item"><span><i class="fa-solid fa-triangle-exclamation" style="color:orange"></i> Sketchy</span><div class="switch" id="toggleSketchy" onclick="togglePurity('sketchy')"></div></div>
                        <div class="setting-item" style="padding-bottom:0; border-bottom:none;"><span><i class="fa-solid fa-ban" style="color:var(--danger)"></i> NSFW</span><div class="switch" id="toggleNSFW" onclick="togglePurity('nsfw')"></div></div>
                    </div>
                    <div id="wallGrid" class="grid"></div>
                    <button id="wallLoadMore" class="load-more-btn" onclick="searchWallhaven(false)">Load More Results</button>
                </div>

                <!-- Layout Settings -->
                <div id="tab-layout" class="view">
                    <h3 style="color:white; margin-bottom:15px;">Widget Visibility</h3>
                    <div class="setting-item"><span>Weather</span><div class="switch" id="showWeather" onclick="toggleLayout('showWeather')"></div></div>
                    <div class="setting-item"><span>Crypto Ticker</span><div class="switch" id="showCrypto" onclick="toggleLayout('showCrypto')"></div></div>
                    <div class="setting-item"><span>Focus Timer</span><div class="switch" id="showTimer" onclick="toggleLayout('showTimer')"></div></div>
                    <div class="setting-item"><span>Tasks</span><div class="switch" id="showTodo" onclick="toggleLayout('showTodo')"></div></div>
                    <div class="setting-item"><span>Notepad</span><div class="switch" id="showNote" onclick="toggleLayout('showNote')"></div></div>

                    <h3 style="color:white; margin:20px 0 10px 0;">Appearance</h3>
                    <div class="setting-item">
                        <span>Glass Blur Intensity</span>
                        <input type="range" min="0" max="50" value="20" class="slider" oninput="updateBlur(this.value)">
                    </div>
                </div>

                <!-- Config -->
                <div id="tab-conf" class="view">
                    <h3 style="color:white; margin-bottom:15px;">General Config</h3>
                    <div class="setting-item"><span>Show Clock</span><div class="switch" id="toggleClock" onclick="toggleConfig('showClock')"></div></div>
                    <div class="setting-item"><span>24-Hour Time</span><div class="switch" id="toggle24h" onclick="toggleConfig('use24h')"></div></div>

                    <div class="setting-item" style="flex-direction:column; align-items:flex-start; gap:10px;">
                        <span>Manual Location (City Name)</span>
                        <input type="text" id="manualLoc" class="modal-input" placeholder="e.g. New York, London..." onchange="saveLoc()">
                    </div>

                    <div class="setting-item" style="margin-top:10px;"><span>Custom Greeting</span></div>
                    <input type="text" id="customGreet" class="modal-input" placeholder="Leave empty for auto..." oninput="saveGreet()">

                    <div class="setting-item" style="margin-top:20px;"><span>Accent Color</span></div>
                    <div class="colors" style="display:flex; gap:15px;">
                        <div style="width:35px; height:35px; background:#3b82f6; border-radius:50%; cursor:pointer;" onclick="setAccent('#3b82f6')"></div>
                        <div style="width:35px; height:35px; background:#8b5cf6; border-radius:50%; cursor:pointer;" onclick="setAccent('#8b5cf6')"></div>
                        <div style="width:35px; height:35px; background:#10b981; border-radius:50%; cursor:pointer;" onclick="setAccent('#10b981')"></div>
                        <div style="width:35px; height:35px; background:#ef4444; border-radius:50%; cursor:pointer;" onclick="setAccent('#ef4444')"></div>
                        <div style="width:35px; height:35px; background:#ffffff; border-radius:50%; cursor:pointer; border:1px solid #333;" title="White/Black" onclick="setAccent('#ffffff')"></div>
                        <div style="width:35px; height:35px; background:#000000; border-radius:50%; cursor:pointer; border:1px solid #555;" title="Black/White" onclick="setAccent('#000000')"></div>
                    </div>

                    <div class="setting-item" style="margin-top:30px; border-top:1px solid #333; padding-top:20px;"><span>Data Management</span></div>
                    <div style="display:flex; gap:10px;">
                        <button class="btn" style="background:#222; flex:1;" onclick="exportData()"><i class="fa-solid fa-download"></i> Backup</button>
                        <button class="btn" style="background:#222; flex:1;" onclick="document.getElementById('importFile').click()"><i class="fa-solid fa-upload"></i> Restore</button>
                        <input type="file" id="importFile" style="display:none" onchange="importData(this)">
                    </div>
                </div>

                <!-- Links -->
                <div id="tab-link" class="view">
                    <h3 style="color:white; margin-bottom:15px;">Edit Links</h3>
                    <div id="linkList"></div>
                    <button class="btn" style="margin-top:15px; width:100%; background:#222;" onclick="addLink()">+ Add Link</button>
                    <button class="btn" style="margin-top:10px; width:100%;" onclick="saveLinks()">Save Changes</button>
                </div>

            </div>
        </div>
    </div>

    <script>
        // --- DATA & STATE ---
        const defaultLinks = [
            { name: 'YouTube', url: 'https://youtube.com', icon: 'fa-brands fa-youtube' },
            { name: 'Reddit', url: 'https://reddit.com', icon: 'fa-brands fa-reddit' },
            { name: 'X', url: 'https://x.com', icon: 'fa-brands fa-x-twitter' },
            { name: 'ChatGPT', url: 'https://chatgpt.com', icon: 'fa-solid fa-robot' }
        ];

        const config = {
            showClock: true, use24h: false, sfw: true, sketchy: false, nsfw: false,
            greet: '', accent: '#3b82f6', manualLoc: '', blur: 20,
            // Layout Visibilities
            showWeather: true, showCrypto: true, showTimer: true, showTodo: true, showNote: true,
            links: JSON.parse(localStorage.getItem('dashLinks')) || defaultLinks,
            todos: JSON.parse(localStorage.getItem('dashTodos')) || [],
            wallKey: 'xTI3zpzyCOeH4ezFz0w30iQmosKjHJV9'
        };

        // --- INIT ---
        function init() {
            const saved = JSON.parse(localStorage.getItem('dashConf'));
            if(saved) Object.assign(config, saved);

            const bg = localStorage.getItem('dashBg');
            if(bg) document.body.style.backgroundImage = `url('${bg}')`;
            else document.body.style.backgroundImage = `url('https://w.wallhaven.cc/full/l8/wallhaven-l83o92.jpg')`;

            document.getElementById('notepad').value = localStorage.getItem('dashNote') || '';

            setAccent(config.accent);
            updateBlur(config.blur);
            updateClock(); setInterval(updateClock, 1000);
            renderLinks(); renderTodos(); updateUI();

            if(config.showWeather) fetchWeather();
            if(config.showCrypto) { fetchCrypto(); setInterval(fetchCrypto, 60000); }
        }

        // --- NOTEPAD ---
        document.getElementById('notepad').addEventListener('input', (e) => {
            localStorage.setItem('dashNote', e.target.value);
        });

        // --- TIMER ---
        let timerInt;
        let timeLeft = 1500; // 25 mins
        function startTimer() {
            clearInterval(timerInt);
            timerInt = setInterval(() => {
                if(timeLeft > 0) {
                    timeLeft--;
                    updateTimerDisplay();
                } else {
                    clearInterval(timerInt);
                    alert("Focus time over!");
                }
            }, 1000);
        }
        function pauseTimer() { clearInterval(timerInt); }
        function resetTimer() { clearInterval(timerInt); timeLeft = 1500; updateTimerDisplay(); }
        function updateTimerDisplay() {
            const m = Math.floor(timeLeft / 60);
            const s = timeLeft % 60;
            document.getElementById('timerDisplay').innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
        }

        // --- CRYPTO ---
        async function fetchCrypto() {
            try {
                const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana&vs_currencies=usd');
                const data = await res.json();
                document.getElementById('price-btc').innerText = `$${data.bitcoin.usd}`;
                document.getElementById('price-eth').innerText = `$${data.ethereum.usd}`;
                document.getElementById('price-sol').innerText = `$${data.solana.usd}`;
            } catch(e) { console.log('Crypto API Limit'); }
        }

        // --- CLOCK ---
        function updateClock() {
            if(!config.showClock) { document.getElementById('clockWidget').style.display='none'; return; }
            document.getElementById('clockWidget').style.display='block';
            const now = new Date();
            let h = now.getHours(); const m = String(now.getMinutes()).padStart(2,'0');
            const gText = config.greet || (h<12?"Good Morning":h<18?"Good Afternoon":"Good Evening");
            document.getElementById('greeting').innerText = gText;
            if(!config.use24h) h = h%12||12;
            document.getElementById('time').innerText = `${h}:${m}`;
            document.getElementById('date').innerText = now.toLocaleDateString('en-US', {weekday:'short', month:'short', day:'numeric'});
        }

        // --- SEARCH ---
        function setEngine(name, btn) {
            const form = document.getElementById('searchForm');
            const input = document.getElementById('searchInput');
            const map = {
                google: { url: 'https://www.google.com/search', ph: 'Search Google...', name: 'q' },
                bing: { url: 'https://www.bing.com/search', ph: 'Search Bing...', name: 'q' },
                youtube: { url: 'https://www.youtube.com/results', ph: 'Search YouTube...', name: 'search_query' }
            };
            form.action = map[name].url; input.placeholder = map[name].ph; input.name = map[name].name;
            document.querySelectorAll('.engine-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        // --- WEATHER ---
        async function fetchWeather() {
            const iconEl = document.getElementById('weatherIcon');
            const descEl = document.getElementById('weatherDesc');
            const tempEl = document.getElementById('weatherTemp');
            const locEl = document.getElementById('weatherLoc');
            descEl.innerText = "Loading...";

            const callApi = async (lat, lon, name) => {
                try {
                    const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&temperature_unit=fahrenheit`);
                    const data = await res.json();
                    tempEl.innerText = Math.round(data.current_weather.temperature) + "°F";
                    const code = data.current_weather.weathercode;
                    let icon = "fa-cloud"; let desc = "Cloudy";
                    if(code === 0) { icon="fa-sun"; desc="Clear"; }
                    else if(code <= 3) { icon="fa-cloud-sun"; desc="Partly Cloudy"; }
                    else if(code <= 67) { icon="fa-cloud-rain"; desc="Rain"; }
                    else if(code <= 99) { icon="fa-bolt"; desc="Storm"; }
                    iconEl.innerHTML = `<i class="fa-solid ${icon}"></i>`;
                    descEl.innerText = desc;
                    locEl.innerText = name;
                } catch(e) { descEl.innerText = "Error"; }
            };

            if (config.manualLoc) {
                try {
                    const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(config.manualLoc)}&count=1&language=en&format=json`);
                    const geoData = await geoRes.json();
                    if(geoData.results && geoData.results.length > 0) callApi(geoData.results[0].latitude, geoData.results[0].longitude, geoData.results[0].name);
                    else descEl.innerText = "City not found";
                } catch(e) { descEl.innerText = "Geo Error"; }
                return;
            }
            navigator.geolocation.getCurrentPosition((pos) => {
                callApi(pos.coords.latitude, pos.coords.longitude, "Local Weather");
            }, () => { descEl.innerText = "Loc. Denied"; locEl.innerText = "Check Settings"; });
        }

        // --- TODO ---
        function renderTodos() {
            const list = document.getElementById('todoList');
            list.innerHTML = '';
            config.todos.forEach((todo, i) => {
                const li = document.createElement('li');
                li.className = `todo-item ${todo.done ? 'done' : ''}`;
                li.innerHTML = `<span onclick="toggleTodo(${i})">${todo.text}</span> <i class="fa-solid fa-trash del-task" onclick="delTodo(${i})"></i>`;
                list.appendChild(li);
            });
            localStorage.setItem('dashTodos', JSON.stringify(config.todos));
        }
        function addTask() {
            const input = document.getElementById('todoInput');
            if(input.value.trim()) { config.todos.push({text:input.value, done:false}); input.value=''; renderTodos(); }
        }
        function toggleTodo(i) { config.todos[i].done = !config.todos[i].done; renderTodos(); }
        function delTodo(i) { config.todos.splice(i,1); renderTodos(); }

        // --- SETTINGS ---
        function toggleSettings(show) {
            const bg = document.getElementById('settingsModal');
            if(show) { bg.classList.add('open'); renderLinkEditor(); updateUI(); } else bg.classList.remove('open');
        }
        document.getElementById('settingsModal').addEventListener('click', e => { if(e.target.id==='settingsModal') toggleSettings(false); });

        function switchTab(id) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');
        }

        function toggleConfig(key) { config[key] = !config[key]; saveConfig(); updateUI(); updateClock(); }
        function toggleLayout(key) { config[key] = !config[key]; saveConfig(); updateUI(); }
        function togglePurity(type) { config[type] = !config[type]; saveConfig(); updateUI(); }

        function updateUI() {
            // Config Toggles
            document.getElementById('toggleClock').classList.toggle('on', config.showClock);
            document.getElementById('toggle24h').classList.toggle('on', config.use24h);

            // Purity
            document.getElementById('toggleSFW').classList.toggle('on', config.sfw);
            document.getElementById('toggleSketchy').classList.toggle('on', config.sketchy);
            document.getElementById('toggleNSFW').classList.toggle('on', config.nsfw);

            // Layout Toggles
            const layoutKeys = ['showWeather', 'showCrypto', 'showTimer', 'showTodo', 'showNote'];
            const widgetMap = {'showWeather':'weatherWidget', 'showCrypto':'cryptoWidget', 'showTimer':'timerWidget', 'showTodo':'todoWidget', 'showNote':'noteWidget'};

            layoutKeys.forEach(k => {
                document.getElementById(k).classList.toggle('on', config[k]);
                const el = document.getElementById(widgetMap[k]);
                if(el) {
                    if(config[k]) el.classList.remove('hidden');
                    else el.classList.add('hidden');
                }
            });

            document.getElementById('customGreet').value = config.greet;
            document.getElementById('manualLoc').value = config.manualLoc;
        }

        function updateBlur(val) {
            config.blur = val;
            document.documentElement.style.setProperty('--glass-blur', val + 'px');
            saveConfig();
        }

        function toggleZenMode() { document.getElementById('mainContainer').classList.toggle('zen-mode'); }

        function setAccent(color) {
            config.accent = color;
            document.documentElement.style.setProperty('--accent', color);
            if (color === '#ffffff') {
                document.documentElement.style.setProperty('--glass-border', '#000000');
                document.documentElement.style.setProperty('--border-width', '3px');
                document.documentElement.style.setProperty('--glass-opacity', '0.9');
                document.documentElement.style.setProperty('--btn-text', '#000000');
            } else if (color === '#000000') {
                document.documentElement.style.setProperty('--glass-border', '#ffffff');
                document.documentElement.style.setProperty('--border-width', '3px');
                document.documentElement.style.setProperty('--glass-opacity', '0.85');
                document.documentElement.style.setProperty('--btn-text', '#ffffff');
            } else {
                document.documentElement.style.setProperty('--glass-border', 'rgba(255, 255, 255, 0.12)');
                document.documentElement.style.setProperty('--border-width', '1px');
                document.documentElement.style.setProperty('--glass-opacity', '0.75');
                document.documentElement.style.setProperty('--btn-text', '#ffffff');
            }
            saveConfig();
        }

        function saveGreet() { config.greet = document.getElementById('customGreet').value; saveConfig(); updateClock(); }
        function saveLoc() { config.manualLoc = document.getElementById('manualLoc').value; saveConfig(); fetchWeather(); }
        function saveConfig() { localStorage.setItem('dashConf', JSON.stringify(config)); }

        // --- BACKUP / RESTORE ---
        function exportData() {
            const data = { config, dashBg: localStorage.getItem('dashBg'), dashNote: localStorage.getItem('dashNote') };
            const str = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data));
            const node = document.createElement('a'); node.setAttribute("href", str); node.setAttribute("download", "dashboard_backup.json");
            document.body.appendChild(node); node.click(); node.remove();
        }
        function importData(input) {
            const file = input.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if(data.config) localStorage.setItem('dashConfig', JSON.stringify(data.config));
                    if(data.config.links) localStorage.setItem('dashLinks', JSON.stringify(data.config.links));
                    if(data.config.todos) localStorage.setItem('dashTodos', JSON.stringify(data.config.todos));
                    if(data.dashBg) localStorage.setItem('dashBg', data.dashBg);
                    if(data.dashNote) localStorage.setItem('dashNote', data.dashNote);
                    alert("Backup restored! Reloading..."); location.reload();
                } catch(err) { alert("Error reading file"); }
            }; reader.readAsText(file);
        }

        // --- LINKS ---
        function renderLinks() {
            const c = document.getElementById('linksContainer'); c.innerHTML='';
            config.links.forEach(l => {
                const a = document.createElement('a'); a.className='shortcut'; a.href=l.url; a.target='_blank';
                a.innerHTML = `<i class="${l.icon.includes('fa-')?l.icon:'fa-solid fa-globe'}"></i><span>${l.name}</span>`;
                c.appendChild(a);
            });
            localStorage.setItem('dashLinks', JSON.stringify(config.links));
        }
        function renderLinkEditor() {
            const l = document.getElementById('linkList'); l.innerHTML='';
            config.links.forEach((link,i) => {
                const div = document.createElement('div'); div.className='setting-item';
                div.innerHTML=`<input class="modal-input" value="${link.name}" onchange="editLink(${i},'name',this.value)" style="margin:0; width:30%;">
                               <input class="modal-input" value="${link.url}" onchange="editLink(${i},'url',this.value)" style="margin:0; width:50%;">
                               <i class="fa-solid fa-trash" style="cursor:pointer; color:var(--danger);" onclick="delLink(${i})"></i>`;
                l.appendChild(div);
            });
        }
        function addLink() { config.links.push({name:'New', url:'https://', icon:'fa-solid fa-globe'}); renderLinkEditor(); }
        function delLink(i) { config.links.splice(i,1); renderLinkEditor(); }
        function editLink(i,f,v) {
            config.links[i][f]=v;
            if(f==='url') {
                if(v.includes('youtube')) config.links[i].icon='fa-brands fa-youtube';
                else if(v.includes('github')) config.links[i].icon='fa-brands fa-github';
                else if(v.includes('reddit')) config.links[i].icon='fa-brands fa-reddit';
                else if(v.includes('x.com')) config.links[i].icon='fa-brands fa-x-twitter';
                else config.links[i].icon='fa-solid fa-globe';
            }
        }
        function saveLinks() { renderLinks(); saveConfig(); event.target.innerText="Saved!"; setTimeout(()=>event.target.innerText="Save Changes",1500); }

        // --- WALLPAPER ---
        let wallPage = 1; let wallQuery = "";
        async function searchWallhaven(newSearch) {
            const grid = document.getElementById('wallGrid');
            const input = document.getElementById('wallInput');
            const loadMoreBtn = document.getElementById('wallLoadMore');
            if(newSearch) { wallPage = 1; wallQuery = input.value; grid.innerHTML = '<p style="color:#888;">Searching...</p>'; loadMoreBtn.style.display = 'none'; }
            else { wallPage++; loadMoreBtn.innerText = "Loading..."; }

            const pStr = (config.sfw?'1':'0') + (config.sketchy?'1':'0') + (config.nsfw?'1':'0');
            const target = `https://wallhaven.cc/api/v1/search?q=${wallQuery}&page=${wallPage}&purity=${pStr}&sorting=relevance&apikey=${config.wallKey}`;
            const url = `https://corsproxy.io/?${encodeURIComponent(target)}`;

            try {
                const res = await fetch(url); const data = await res.json();
                if(newSearch) grid.innerHTML = '';
                if(data.data && data.data.length > 0) {
                    data.data.forEach(img => {
                        const d = document.createElement('div'); d.className='grid-item';
                        d.innerHTML=`<img src="${img.thumbs.small}">`; d.onclick=()=>setBg(img.path);
                        grid.appendChild(d);
                    });
                    loadMoreBtn.style.display = 'block'; loadMoreBtn.innerText = "Load More Results";
                } else { if(newSearch) grid.innerHTML = '<p style="color:#666;">No results.</p>'; loadMoreBtn.style.display = 'none'; }
            } catch(e) { if(newSearch) grid.innerHTML='<p style="color:red">Error loading images</p>'; }
        }
        function setBg(url) { document.body.style.backgroundImage = `url('${url}')`; localStorage.setItem('dashBg', url); toggleSettings(false); }

        init();
    </script>
</body>
</html>
